#!/bin/bash
set -eou pipefail

# Scenario: Feature branch when origin/main has moved forward
#
#   A -- B -- C (origin/main)
#         \
#          D (HEAD, feature)
#
# We branched from B, but origin/main moved to C.
# Expected: B

mkdir origin
pushd origin > /dev/null
git init > /dev/null
git commit --allow-empty -m "A" > /dev/null
git commit --allow-empty -m "B" > /dev/null

git rev-parse HEAD

git commit --allow-empty -m "C" > /dev/null
popd > /dev/null

git clone origin repo > /dev/null 2>&1
pushd repo > /dev/null

# Go back to B and create feature branch
git checkout HEAD~1 > /dev/null 2>&1
git checkout -b feature > /dev/null 2>&1
git commit --allow-empty -m "D" > /dev/null

# Simulate origin moving forward by fetching
git fetch origin > /dev/null 2>&1
