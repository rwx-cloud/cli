#!/bin/bash
set -eou pipefail

# Scenario: Detached HEAD at exactly origin/main (no divergence)
#
#   A (origin/main, HEAD detached)
#
# Clone and detach at the same commit as origin/main.
# Expected: A (HEAD)

mkdir origin
pushd origin > /dev/null
git init > /dev/null
git commit --allow-empty -m "A" > /dev/null

git rev-parse HEAD

popd > /dev/null

git clone origin repo > /dev/null 2>&1
pushd repo > /dev/null
git checkout $(git rev-parse HEAD) > /dev/null 2>&1
