on:
  github:
    push:
      if: ${{event.git.branch == 'main' }}
      init:
        commit-sha: ${{ event.git.sha }}
        ref: ${{ event.git.ref }}
  cli:
    init:
      commit-sha: ${{ event.git.sha }}
      ref: ${{ event.git.sha }}

concurrency-pools:
  - id: rwx-cloud/cli:main
    capacity: 1
    on-overflow: cancel-waiting

tasks:
  - key: ci
    call: ${{ run.dir }}/ci.yml
    init:
      commit-sha: ${{ init.commit-sha }}
      ref: ${{ init.ref }}

  - key: release-unstable
    after: [ci]
    call: ${{ run.dir }}/release.yml
    init:
      kind: unstable
      commit: ${{ init.commit-sha }}
      version: UNSTABLE
